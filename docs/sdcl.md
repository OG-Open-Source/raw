# SDCL 1.1

以下是 OGATA 標準通用數據字符儲存格式語言（OGATA's Standard Data Character Storage Language，簡稱 OGATA-SDCL 或 SDCL）的完整格式規範，涵蓋所有語法規則、類型系統及高級功能。

---

## 目錄

- [基本語法結構](#基本語法結構)
- [類型系統](#類型系統)
- [資料結構與嵌套](#資料結構與嵌套)
- [多行字串處理](#多行字串處理)
- [錯誤代碼總覽](#錯誤代碼總覽)
- [最佳實踐](#最佳實踐)
- [附錄](#附錄)
- [貢獻指南](#貢獻指南)
- [許可證](#許可證)

---

## 基本語法結構

### 鍵值對基礎

```sdcl
# 基本鍵值對
key: value

# 等價的三種括號形式
object1: { a:1, b:2 }
object2: [ a:1, b:2 ]
object3: ( a:1, b:2 )

# 列表結構
list: [1, "text", <int>3</int>]
```

### 鍵名規則

| 鍵名類型       | 允許字符                       | 範例                  | 解析規則               |
|----------------|--------------------------------|-----------------------|------------------------|
| **裸鍵**       | `A-Za-z0-9_-`                 | `server_port`         | 不可為空               |
| **數字鍵**     | 純 ASCII 數字                 | `8080`                | 自動轉為字串           |
| **引號鍵**     | 任意 Unicode                  | `"server.port"`       | 需顯式包裹             |
| **點分隔鍵**   | 需包裹在括號或引號中          | `(server.port)`       | 解析為單一鍵名         |

{:.note}
> 鍵名設計時應避免使用特殊字符，除非明確需要包裹在引號中。

### 鍵名衝突與覆蓋

```sdcl
# 點分隔鍵 vs 包裹鍵
physical.color: "red"     # → { physical: { color: "red" } }
"physical.color": "blue"  # → { "physical.color": "blue" }

# 重複鍵名處理
fruit: "apple"
fruit: "banana"           # 最終值 → "banana"
```

{:.warning}
> 重複鍵名會導致後者覆蓋前者，建議避免重複鍵名以確保數據清晰。

---

## 類型系統

### 類型標籤規範

| 標籤            | 正確用法範例                | 錯誤用法範例          | 解析規則               |
|-----------------|----------------------------|-----------------------|------------------------|
| `<str></str>`   | `<str>text</str>`          | `<str>text`           | 必須閉合標籤           |
| `<int></int>`   | `<int>8080</int>`          | `<int>"8080"</int>`   | 內容需為純數字          |
| `<float></float>` | `<float>3.14</float>`      | `<float>3,14</float>` | 小數點格式錯誤         |
| `<null>`        | `<null/>` 或 `<null>`      | `<null> </null>`      | 空標籤禁止內容         |

{:.important}
> 類型標籤必須嚴格閉合，否則會觸發 `T002` 錯誤。

### 自動類型推斷

```sdcl
42         → <int>       # 整數
"text"     → <str>       # 字串
true       → <bool>      # 布林值
{}/[]/()   → null        # 空結構等價 null
```

{:.tip}
> 自動類型推斷適用於簡單數據，複雜數據建議顯式標註類型。

### 數值系統

#### 整數規範

```sdcl
int1: +42        # 正整數
int2: -17        # 負整數
int3: 1_000_000  # 千分位分隔 (僅可視化用途)
```

{:.note}
> 千分位分隔符僅用於可視化，解析時會被忽略。

#### 浮點數規範

| 合法格式        | 非法格式          | 解析規則               |
|-----------------|-------------------|------------------------|
| `+1.0`          | `.7`              | 需明確前後數字         |
| `3.1415`        | `7.`              | 禁止尾部孤點           |
| `-2E-2`         | `3.e+20`          | 指數需完整             |
| `6.626e-34`     | `224_617.445_991` | 禁止分隔符             |

{:.caution}
> 浮點數的指數部分必須完整，例如 `3.e+20` 是非法格式。

### 日期時間類型

#### 類型標籤對照

| 標籤                | 範例格式                        | 說明                     |
|---------------------|---------------------------------|--------------------------|
| `<date></date>`     | `2023-10-01`                   | 本地日期                 |
| `<time></time>`     | `14:30:00.999`                 | 本地時間                 |
| `<datetime></datetime>` | `2023-10-01T14:30:00`       | 本地日期時間             |
| `<datetime></datetime>` | `1979-05-27T07:32:00Z`     | UTC 時區日期時間         |

#### 非法格式示例

```sdcl
err_date: 1979-05-27 07:32:00Z  # 缺少 T 分隔符 → 觸發 D002 錯誤
```

{:.warning}
> 日期時間格式必須嚴格遵循 ISO 8601 標準，否則會觸發錯誤。

---

## 資料結構與嵌套

### TOML 風格路徑語法

```sdcl
# 路徑式鍵名展開
server.ports.http: 80
server.ports.https: 443

# 解析結果
server: {
  ports: {
    http: 80
    https: 443
  }
}
```

{:.tip}
> 路徑語法適合用於層級較少的配置，簡化鍵名設計。

### 顯式列表結構

```sdcl
# 列表內含鍵值對
server.ports: [
  http: 80
  https: 443
]

# 解析結果
server: {
  ports: [
    { http: 80 },
    { https: 443 }
  ]
}
```

{:.note}
> 顯式列表結構適合用於複雜數據，便於維護和擴展。

### 特殊鍵名結構

```sdcl
# 引號包裹的複合鍵名
"server.ports": [
  http: 80
  https: 443
]

# 解析結果
{
  "server.ports": [
    { http: 80 },
    { https: 443 }
  ]
}
```

{:.caution}
> 複合鍵名需包裹在引號中，否則會被解析為路徑語法。

### 數組與行內表

#### 數組規範

```sdcl
# 單行模式 (空格/逗號分隔)
numbers: [0.1, 0.2 0.5, 1 2 5]

# 多行模式 (換行分隔)
users: [
  "Alice <alice@example.com>"
  { name: "Bob" email: "bob@example.com" }
]

# 混合類型數組
mixed: [
  true
  <date>2023-10-01</date>
  { key: "value" }
]
```

{:.important}
> 數組內的元素類型可以混合，但建議保持一致性以提高可讀性。

#### 行內表規範

```sdcl
# 單行行內表
profile: { name: "Alice" age: 30 }

# 多行展開
profile: (
  name: "Bob"
  age: 25
)
```

{:.tip}
> 行內表適合用於簡單的鍵值對結構，複雜數據建議使用顯式列表。

---

## 多行字串處理

### 多行語法形式

```sdcl
# 縮進塊模式 (自動去除首尾空行)
text1:
  Line 1
  Line 2
→ "Line 1\nLine 2"

# 標籤模式 (等同雙引號轉義)
text2: <str>
  Line 1
    Line 2
</str>
→ "Line 1\n  Line 2"
```

{:.note}
> 縮進塊模式會自動去除首尾空行，適合用於純文本內容。

### 轉義規則對照

| 語法形式       | 輸入內容            | 解析結果           |
|----------------|---------------------|--------------------|
| `"..."`        | `"Line\nEnd"`      | `Line\nEnd`        |
| `<str>...</str>` | `<str>Line\nEnd</str>` | `Line\nEnd`    |
| `'...'`        | `'Line\nEnd'`      | `Line\\nEnd`       |

{:.caution}
> 單引號字串不會轉義特殊字符，需手動處理轉義序列。

#### 特殊轉義符號

| 轉義序列       | Unicode 碼位       | 說明                  |
|----------------|--------------------|-----------------------|
| `\b`           | U+0008             | 退格符                |
| `\uXXXX`       | U+XXXX             | 4位十六進制 Unicode   |
| `\UXXXXXXXX`   | U+XXXXXXXX         | 8位十六進制 Unicode   |

{:.important}
> 轉義序列需嚴格遵循 Unicode 規範，否則會觸發解析錯誤。

---

## 錯誤代碼總覽

| 代碼  | 類型                 | 觸發條件範例                  | 解決方案               |
|-------|----------------------|-------------------------------|------------------------|
| T002  | 類型標籤未閉合       | `<int>8080`                   | 補全 `</int>`          |
| S203  | 多行未包裹逗號       | ```[<br>item1,<br>item2<br>]``` | 改用換行或包裹逗號    |
| S204  | 鍵值對跨行未對齊     | ```key:<br>  value```         | 保持縮進一致          |
| D001  | 日期格式錯誤         | `<date>20231001</date>`       | 改用 `YYYY-MM-DD`     |
| K201  | 非法裸鍵字符         | `server-port!`                | 使用合法字符          |
| T101  | 浮點數格式錯誤       | `flt: 3.e+20`                 | 修正指數格式          |
| D002  | 日期時間分隔符缺失   | `2023-10-01 14:30:00Z`        | 添加 `T` 分隔符       |

{:.warning}
> 錯誤代碼需根據具體場景進行處理，建議啟用嚴格模式以提前發現問題。

---

## 最佳實踐

### 類型標籤規範化

```sdcl
# ✅ 統一閉合標籤
port: <int>8080</int>
api_version: <str>v1.2.3</str>

# ❌ 避免混合風格
err: <int>8080</float>  # 標籤不匹配
```

{:.important}
> 類型標籤的統一性有助於提高代碼的可讀性和可維護性。

### 結構選擇建議

```sdcl
# 簡單配置使用路徑語法
db.mysql.timeout: 30

# 複雜數據使用顯式列表
users: [
  { name: "Alice", roles: ["admin"] }
  { name: "Bob", roles: ["user"] }
]
```

{:.tip}
> 根據數據複雜度選擇合適的結構，避免過度嵌套。

### 錯誤預防配置

```sdcl
# 啟用嚴格模式
strict_mode: {
  tag_closure: true      # 強制標籤閉合
  multiline_comma: false # 禁止多行逗號
}
```

{:.note}
> 嚴格模式有助於提前發現潛在問題，建議在開發環境中啟用。

### 鍵名設計原則

```sdcl
# ✅ 明確的點分隔鍵
(server.main_port): 8080

# ❌ 歧義鍵名
server.port: 8080    # 可能誤解為嵌套結構
```

{:.caution}
> 鍵名設計應避免歧義，確保解析結果符合預期。

### 數值可讀性

```sdcl
# 千分位分隔 (僅可視化)
population: 7_800_000_000  # → 7800000000

# 科學計數法
avogadro: 6.022e+23
```

{:.tip}
> 數值格式化有助於提高可讀性，但需注意解析時的兼容性。

---

## 附錄

### 速查表

| 場景                | 標準寫法                   | 等價形式                  | 非法寫法                  |
|---------------------|---------------------------|---------------------------|---------------------------|
| 類型強制轉換        | `<int>8080</int>`         | 整數 8080                | `<int>8080</float>`       |
| 多層路徑鍵名        | `server.(port.config): 80` | `server: { port.config: 80 }` | `server.port.config: 80` |
| 空值表示            | `log_level: <null/>`      | 明確標記為 null          | `log_level: null`         |
| 時區日期時間        | `<datetime>2023-10-01T08:00+08:00</datetime>` | `2023-10-01 08:00+08:00` | |
| 行內表嵌套          | `config: { db: { port: 3306 } }` | `config: { db.port: 3306 }` | |
| 空值安全訪問        | `user?.profile?.email`    | `user.profile.email` (可能觸發空值錯誤) | |

---

## 文件與傳輸規範

1. **文件擴展名**：`.sdcl`  
2. **MIME 類型**：`application/sdcl`  

---

## 貢獻指南

1. Fork 專案
2. 創建功能分支
3. 提交更改
4. 發起 Pull Request

## 許可證

本專案採用 MIT 許可證。
